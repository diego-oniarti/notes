\documentclass{article}

\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{semantic}
\usepackage{cancel}

\input{../common}

\newcommand{\na}[0]{\ensuremath {\overset{N}{\rightarrow}}}
\newcommand{\rl}[3]{\inference{#1}{#2}\text{ #3}}
\newcommand{\bop}[0]{\ensuremath\oplus}
\newcommand{\appl}[2]{\ensuremath(#1)\ #2}
\newcommand{\st}[3][]{\ensuremath{\displaystyle\frac{#3\hfill}{#2\hfill} \text{#1}}}
\newcommand{\N}{\ensuremath \mathbb N}
\newcommand{\lam}[2]{\ensuremath{\lambda#1.#2}}
\newcommand{\inl}[0]{\ensuremath{\ inL\ }}
\newcommand{\inr}[0]{\ensuremath{\ inR\ }}
\newcommand{\case}[3]{\ensuremath{\text{case}\ #1\ \text{of}\ \left|\begin{aligned}#2\\#3\end{aligned}\right.}}
\newcommand{\Da}[0]{\ensuremath{\Downarrow}}
\usepackage{pdflscape}

\title{Assignment \#1}
\author{Diego Oniarti}
\begin{document}

\maketitle

\section{Big step - call by name}
Write the operational semantics rules for a big-step, call-by-name reduction for ULC. Write the semantically correct ones only, but write them all

\[\begin{array}{cl}
    \st{v\Downarrow v}{} & \text{val}\\
    \\
    \st{t \bop t' \Downarrow n}{t\Downarrow n' \quad t'\Downarrow n" \quad n'\bop n" = n} & \text{bs-bop} \\
    \\
    \st{t\ t'\Downarrow v}{t\Downarrow \lam{x}{t"} \quad t"[t'/x]\Downarrow v}  & \text{bs-app} \\
    \\
    \st{\langle t_1, t_2 \rangle \Downarrow \langle v_1,v_2 \rangle}{t_1\Downarrow v_1\quad t_2\Downarrow v_2} & \text{pair} \\
    \\
    \st{t.1\Downarrow v}{t\Downarrow \langle v,v' \rangle} & \text{first-projection} \\
    \\
    \st{t.2\Downarrow v}{t\Downarrow \langle v',v \rangle} & \text{first-projection} \\
    \\
    \st{inL\ t\Downarrow inL\ v}{t\Downarrow v} & \text{inLeft} \\
    \\
    \st{inR\ t\Downarrow inR\ v}{t\Downarrow v} & \text{inRight} \\
    \\
    \st{\case{t}{\inl x_1\mapsto t_1}{\inr x_2\mapsto t_2}\Downarrow v}{t\Da \inl v' \quad t_1[v'/x_1]\Da v} & \text{pattern matching L}
    \\ \\
    \st{\case{t}{\inl x_1\mapsto t_1}{\inr x_2\mapsto t_2}\Downarrow v}{t\Da \inr v' \quad t_2[v'/x_2]\Da v} & \text{pattern matching R}
\end{array}\] 

\section{Equivalence of SOS and COS}

\section{Distinguish terms}
% ( (t -> t') -> (n -> n -> t) -> t' ) -> n
% (t -> t') -> (n -> n -> t) -> t'
\begin{multline*}
    % t\overset{def}=\lam{d:(\N\to\tau\to\tau')\to(\N\to\N\to\tau)\to\tau'\\}{d\ (\lam{m:\N}{\lam{b:\tau}{b}})\ (\lam{i:\N}{\lam{n:\N}{i}})}
    t\overset{def}=\lam{d:(\N\to\N\to\N)\to(\N\to\N\to\N)\to\N\\}{d\ (\lam{a:\N}{\lam{b:\N}{b}})\ (\lam{i:\N}{\lam{j:\N}{i}})}
\end{multline*}

\paragraph{Reduction 1}
\begin{align*}
    &\begin{array}{l @{\leadsto} c l}
        (\lam{d}{d\ (\lam{a}\lam{b}{b})\ (\lam{i}\lam{j}{i})})\ (\lam{x}\lam{y}{x\ 0\ (y\ 0\ 0)}) \\
        (\lam{x}\lam{y}{x\ 0\ (y\ 0\ 0)})\ (\lam{a}\lam{b}{b})\ (\lam{i}\lam{j}{i}) \\
        (\lam{y}{(\lam{a}\lam{b}{b})\ 0\ (y\ 0\ 0)})\ (\lam{i}\lam{j}{i}) \\
        (\lam{a}\lam{b}{b})\ 0\ ((\lam{i}\lam{j}{i})\ 0\ 0)\  \\
        (\lam{b}{b})\ ((\lam{i}\lam{j}{i})\ 0\ 0)\  \\
        (\lam{b}{b})\ ((\lam{j}{0})\ 0)\  \\
        (\lam{b}{b})\ 0 \\
    \end{array}\\
    &\quad 0
\end{align*}

\paragraph{Reduction 2}
\begin{align*}
    &\begin{array}{l @{\leadsto} c l}
        (\lam{d}{d\ (\lam{a}\lam{b}{b})\ (\lam{i}\lam{j}{i})})\ (\lam{x}\lam{y}{x\ 0\ (y\ 1\ 0)}) \\
        (\lam{x}\lam{y}{x\ 0\ (y\ 1\ 0)})\ (\lam{a}\lam{b}{b})\ (\lam{i}\lam{j}{i}) \\
        (\lam{y}{(\lam{a}\lam{b}{b})\ 0\ (y\ 1\ 0)})\ (\lam{i}\lam{j}{i}) \\
        (\lam{a}\lam{b}{b})\ 0\ ((\lam{i}\lam{j}{i})\ 1\ 0)\  \\
        (\lam{b}{b})\ ((\lam{i}\lam{j}{i})\ 1\ 0)\  \\
        (\lam{b}{b})\ ((\lam{j}{1})\ 0)\  \\
        (\lam{b}{b})\ 1 \\
    \end{array}\\
    &\quad 1
\end{align*}

% \begin{multline*}
%     t\overset{def}=\lam{d:(\N\to\tau\to\tau')\to(\N\to\N\to\tau)\\\to\tau'}{d\ (\lam{m:\N}{\lam{b:\tau}{b}})\ (\lam{i:\N}{\lam{n:\N}{i*n_1+(1-i)*n_2}})}
% \end{multline*}

\section{Safe untypable term}
\begin{equation*}
    (\lam{x:\N\to\N}{x})\ 1
\end{equation*}

\paragraph{typing derivation}
\begin{align*}
    \st[$\cancel{app}$]{
        \emptyset\vdash (\lam{x:\N\to\N}{x})\ 1: 
    }{
        \st[lam]{
            \emptyset\vdash\lam{x:\N\to\N}{x}:(\N\to\N)\to(\N\to\N)
        }{
            \st[var]{
                x:\N\to\N\vdash x:\N\to\N
            }{
                x:\N\to\N\in\Gamma
            }
        }
        \quad
        \st[nat]{
            \emptyset\vdash 1:\N
        }{}
    }
\end{align*}

\paragraph{COS-SM-CBV}
\begin{align*}
    (\lam{x:\N\to\N}{x})\ 1 \leadsto 1
\end{align*}

\section{Typing derivation}
\begin{equation*}
    \st[app]{
        \Gamma\left\{f:\N\to\N\right. \vdash f\ ((\lam{x}{x+2})\ 4): \N
    }{
        \st[var]{
            \Gamma \vdash f:\N\to\N
        }{
            f:\N\to\N \in \Gamma
        }
        \quad
        \st[app]{
            \Gamma\vdash (\lam{x}{x+2})\ 4: \N
        }{
            \st[lam]{
                \Gamma\vdash \lam{x}{x+2}:\N\to\N
            }{
                \st[op]{
                    \Gamma'\left\{\substack{f:\N\to\N\hfill,\\x:\N\hfill}\right.\vdash x+2:\N
                }{
                    \st[var]{
                        \Gamma'\vdash x:\N
                    }{
                        x:\N\in\Gamma'
                    }
                    \quad
                    \st[nat]{
                        \Gamma'\vdash 2:\N
                    }{
                    }
                }
            }
            \quad
            \st[nat]{
                \Gamma\vdash 4:\N
            }{}
        }
    }
\end{equation*}

\begin{equation*}
    \st[app]{
        \Gamma\left\{f:\N\to\N\right. \vdash ((\lam{x}{\lam{y}{x\ y}})\ f)\ 3:\N
    }{
        \st[app]{
            \Gamma\vdash (\lam{x}{\lam{y}{x\ y}})\ f: \N\to\N
        }{
            \st[lam]{
                \Gamma\vdash \lam{x}{\lam{y}{x\ y}}: (\N\to\N)\to\N\to\N
            }{
                \st[lam]{
                    \substack{\Gamma,\hfill\\x:\N\to\N}\vdash \lam{y}{x\ y}:\N\to\N
                }{
                    \st[app]{
                        \Gamma' \left\{ \substack{\Gamma,\hfill\\x:\N\to\N,\\y:\N\hfill} \right. \vdash x\ y:\N
                    }{
                        \st[var]{
                            \Gamma'\vdash x:\N\to\N
                        }{
                            x:\N\to\N\in\Gamma'
                        }
                        \quad
                        \st[var]{
                            \Gamma'\vdash y:\N
                        }{
                            y:\N\in\Gamma'
                        }
                    }
                }
            }
            \quad
            \st[var]{
                \Gamma\vdash f:\N\to\N
            }{
                f:\N\to\N\in\Gamma
            }
        }
        \quad
        \st[nat]{
            \Gamma\vdash 3:\N
        }{
        }
    }
\end{equation*}

\section{Encoding}
\paragraph{Sequencing}
\begin{gather*}
    t ::= \cdots | t;t' \\
    (\lam{x}{t'})\ t
\end{gather*}
(Assuming $x$ is a free variable not used in x)

\paragraph{Let-in}
\begin{gather*}
    t ::= \cdots | let\ x=t\ in\ t' \\
    (\lam{x}{t'})\ t
\end{gather*}

\paragraph{Arrays of Length 4}
\begin{gather*}
    t ::= \cdots | [t,t,t,t] \\
    v ::= \cdots | [v,v,v,v] \\
    [a,b,c,d] \equiv <<a,b>,<c,d>>
\end{gather*}

\paragraph{Array field access}
\begin{gather*}
    t ::= \cdots | t.i\ (i\in0..3) \\
    t.0 \equiv t.0.0 \\
    t.1 \equiv t.0.1 \\
    t.2 \equiv t.1.0 \\
    t.3 \equiv t.1.1
\end{gather*}

\paragraph{Array update}
\begin{gather*}
    t ::= \cdots | t.i=t\ (i\in0..3) \\
    t.0=t' \equiv <<t',t.0.1>,<t.1.0,t.1.1>> \\
\end{gather*}

\end{document}
